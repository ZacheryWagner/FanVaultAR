# FAN VAULT READ ME

The following is documentation outlining the technical details of the Unity Fan Vault Experience. In general, it is a pretty simple project but there are a few interesting pieces of functionality and gotchas that I'll address here.

## Used vs Unused scripts

In the development process I wrote several scripts that I ended up not using because I found a better solution.  That said, all those unused scripts do compile and might be useful for you in the future as reference material, so I left them in the project. Here is an explanation of every script in the project.

### Used:
- `ButtonManager`: handles button tapping and scene switching 
- `ChestOpenClose`: triggers both the Chest Opening/Closing Animations and the Chest Annotation Show/Hide
- `EmblemAnnotationController`: triggers the show/hide on the emblem annotation
- `FirstPersonController`: first person movement in manual mode
- `GateOpenClose`: triggers the gate opening animation
- `PlaceOnPlaneOnce`: portal placement
- `PrefabLightmapData`: takes existing lightmap data geenerated via Unity's lightmap generator and maps it to a prefab.

## Unused
- `SerializedVector3`: a helper class for allowing the developer to serialize a vector.  This was useful when I was allowing the dev to manually move the object around but that solution went out the window when we changed the placement to be relative to the camera.
- `SerializedQuarternion`: same as above, just a serialized Quarternion helper class.  Both of these fully work and will likely be useful for you someday.
- `PortalManager`: a useful script for making the invisible plane within the portal a trigger that applies a shader to whatever materials in the scene you chose.  This was unnecessary for this project but if you ever want an AR experince where you can walk in and it starts showing new gameobjects behind you, used this.
- `MakeAppearOnPlane`: very neat script, instead of moving the object to be positioned in front of the player it moves the ARSessionOrigin to be in front of the given transform provided.

## Shaders
All of the shaders I wrote were modified versions of the default unity shader bundle that you can download at the same place you download versions of Unity.  They are all commented. If you need any help understanding them see: https://docs.unity3d.com/2019.3/Documentation/Manual/SL-SubShaderTags.html

- `DepthMask`: apply this to the outer room material and it will become invisible without showing what's behind it
- `FeatherPlane`: a nice feathering shader you can apply to the ground if you want
- `Stencil Shaders`: all three of these are unsed, but you would apply these to the materials you want to trigger based on the unsed `PortalManager` above

## Baking Lightmap Data

### Why
Unity cannot bake lighting into prefabs.  This is so very unfortuante for a number of reasons including performance.  Because our experience is instantiated upon user placement, you have to use a prefab.  For a detailed explanation on why baking the lighting on mobile maps and how one might go about that see: 
https://unity.com/how-to/advanced/optimize-lighting-mobile-games

### How
1. Place Prefab in Scene
2. Add `PrefabLightmapData` as a component to the root node of the prefab you would like to bake lighting into
3. Bake the lighting like you normally would `(Window > Lighting > Backed Generate)`
4. Bake it into the prefab with the script: `Asset > Bake Prefab Lightmap`

### Reflection Probes
When baking lightmaps, unity bakes reflection probes into a cubemap, this cubemap will need manually assigned to any reflection probe. For baking prefabs with reflection probes do the following:
1. Steps 1 and 2 above
2. In the Light Explorer, make sure Reflection Probes are set to bake
3. Steps 3 and 4 above
4. Go into your prefab in prefab view, find the reflection probes and change them from `baked` to `custom`.
5. Assign the reflection probe's cubemap to the cubemap that was generated by the baking.  It will be called `reflectionprobe-0` (or whatever number of reflection probes you have) and located in the folder with Scenes that was generated when you baked the lights

## Place on Plane once
I wanted to take a second to elaborate on the process here because there were some very annoying gotchas that had me stuck for a while.  
- First of all, if you ever modify this script I **HIGHLY** recommend changing the prefab for the AR room to the Manual Room while testing.  As listed in the Unity documentation, quaternions are wild and hard to measure.  You may adjust a value slightly and suddenly the AR room will appear like it's not rendering, it is, it's probably just backwards and invisisble.
- Second you'll notice I transform the rotation on a separate frame as the position.  This is because unity does best when you minimize the number of transforms and when you do those transforms on a separate frame.  This is also why I calculate the position prior to placement despite it being a little harder to code (one less transform).
- There is a setting in `Player>Physics` called `Auto Sync Transforms`, this defaults to `off` and needs to be `on`.  It allows for teleporting game objects regardless of Time.DeltaTime.
- You'll notice some little adjustments to the rotation that seem like magic numbers.  This is because the FBX pivot point isn't centered, so when rotating it will offset the x position.  Blame Dylan lol

## Pitfalls/Tips
Quick little list to help you out.  A lot of this is specified above but putting this here as well to reduce your suffering.
- Test placement with the manual prefab and not the invisible one
- Set `Auto Sync Transforms` to `true`
- Transforms work best on separate frames, minimize the number of transforms when possible.  *You can normally combine multiple movements into one transform*
- Remember to assign the lightmap data script to the root node of your prefab.  The option in `Assets` will showup regardless so if the script isn't assigned you'll just be baking the lightmap data onto nothing.
- **FBX imports are prefabs.** This was a very annoying one for me.  When you import an FBX it is now its own prefab and there is no way of getting around it behaving like a prefab.  Even if you create two prefabs from it and try to change one it will change the root FBX prefab.  I recommend not using fbx imports for this reason honestly.
- AR Dev is just GameDev and every GameDev problem in the world has already been solved so just look up GameDev solutions and then ARify them.

## Installation
All packages are from Unity so there's nothing you have to do except download the project.
Unity Vesion: `2021.2.8`

## Used By

[Drund](https://team.drund.com/)


## Authors

[@zacherywagner](https://www.github.com/zacherywagner)
